# Зачем нам нужен GetHashCode()

Источники:
- [Тред на cyberforum](http://www.cyberforum.ru/csharp-beginners/thread640593.html)
- [Откуда растут руки у GetHashCode в .NET - Habr.com](https://habr.com/ru/post/188038/)
- [Generate Equals and GetHashCode method overrides- MSDN](https://docs.microsoft.com/en-us/visualstudio/ide/reference/generate-equals-gethashcode-methods?view=vs-2019)
- [Описание hash code - MSDN](https://docs.microsoft.com/ru-ru/dotnet/api/system.object.gethashcode?redirectedfrom=MSDN&view=netframework-4.8#%D0%BA%D0%BE%D0%BC%D0%BC%D0%B5%D0%BD%D1%82%D0%B0%D1%80%D0%B8%D0%B8)

---

GetHashCode используется для ускорения сравнения двух объектов. Если требуется узнать, одинаковы ли какие-то два объекта, то сначала сравниваются их хэш-коды. Если они различаются, то значит и объекты различны. Если же совпадают, то тогда начинается дорогостоящее "настоящее" сравнение через Equals.

Таким образом, GetHashCode должен: 
- совпадать для одинаковых объектов
- отличаться для разных объектов
- достаточно быстро вычисляться (чтобы в его использовании вообще был смысл).

Некоторые алгоритмы поиска (например, ключа в словаре), сначала сравнивают хэши, а затем, при необходимости, Equals.

## Примеры реализации:
- если у вас в классе одно целое поле int i, то в GetHashCode вы его и возвращаете: return i
- если у вас в классе два целых поля int i и int j, то вы возвращаете XOR: return i^j
и так далее.

Очевидно что если у двух объектов поля i равны и поля j равны, то и i^j, то есть хэши, будут равны. С другой стороны, если хотя бы одно из полей не совпадает, то с высокой долей вероятности и i^j не будет совпадать. Плюс сравнить хэш коды быстрее, чем сравнить две пары целых. Что и требуется для хорошей хэш-функции.

В [документации](https://docs.microsoft.com/en-us/visualstudio/ide/reference/generate-equals-gethashcode-methods?view=vs-2019) сказано, что если переопределяете Equals (то есть задаете свое правило сравнения объектов), то и GetHashCode надо переопределить (чтобы он новому вашему правилу соответствовал). А если не переопределяете, то и не надо GetHashCode трогать. Все объекты будут по ссылке сравниваться.

## Примечание

Использоваться хэш-код может во множестве алгоритмов, в том числе и кастомных. Хэш код также используется в [Hashtable](https://docs.microsoft.com/ru-ru/dotnet/api/system.collections.hashtable?view=netframework-4.8) - коллекции пар "ключ-значени", где ключи упорядочены по хэш-коду.

## Вывод

Иными словами, GetHashCode необходим для вычисления, эквивалентны ли два объекта или нет, и нужно ли переходить к проверке эквивалентности на основе Equals.


